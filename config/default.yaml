seed: 42

viz:
  backend: "TkAgg"   # "TkAgg" or "Qt5Agg"
  dim: "2d"          # "2d" or "3d"
  mode: "live"       # "live" or "still"
  record: false
  safety_plot: true

sim:
  dt: 0.02
  interval_ms: 10
  substeps:
    live: 2
    record: 1
  termination:
    goal_delta: 0.25
    settle_seconds: 1.0
    max_frames: 2000

agents:
  num_agents: 4
  init:
    mode_2d: "lanes"
    lanes:
      x_min: -4.0
      x_max: -2.0
      y_spacing: 0.8
  goals:
    mode_2d: "lanes"
    lanes:
      x_min: 2.0
      x_max: 4.0
      y_spacing: 0.8
      reverse_order: true

world:
  obstacles:
    num_override: null

    dynamic:
      enabled: true # Must be true for bouncing to matter
      vel_range: [-1.0, 1.0]
      

    num_obs_2d: 8   # 4 per wall + (num_obs_2d-4) obstacles inside walls
    num_obs_3d: 12  # 6 per wall + (num_obs_3d-6) obstacles inside walls
    radius_range: [0.2, 0.5]

    walls_2d:
      enabled: true
      x_min: -5.0   # Left Wall
      x_max: 5.0   # Right Wall
      y_min: -5.0  # Bottom Wall
      y_max: 5.0    # Top Wall

    walls_3d:
      enabled: true
      x_min: -5.0
      x_max: 5.0
      y_min: -5.0
      y_max: 5.0
      z_min: 0.0
      z_max: 10.0
    
    spawn_box_2d:
      min: [-4.0, -4.0,  0.0]
      max: [ 4.0,  4.0,  0.0]
    spawn_box_3d:
      min: [ 0.5,   0.5,  0.5]
      max: [ 4.5,   4.5,  4.5]
      
    clear_zone_margin: 0.8

limits:
  nom_clip_fraction: 0.8

controller:
  dim_defaults:
    a_max_2d: 20.0
    a_max_3d: 25.0

  cbf:
    k1: 15.0
    k2: 10.0
    agent_radius: 0.05
    buffer_obstacles: 0.10
    buffer_agents: 0.05

  qp:
    slack_weight: 1.0e12
    fallback_zero_on_fail: true

  admm:
    enabled: true
    rho: 0.1
    iters: 3

  connectivity:
    enabled: true
    k_neighbors: 3
    gain: 5.0
    l2_threshold: 0.5
    inject_into_nominal: false

  nominal:
    enabled: true

    # Far-field goal tracking (unit-vector push) with damping
    v_damp_far: 2.0

    pd:
      switch_dist: 0.1
      kp: 5.0
      kd: 3.0

    repulsion:
      enabled: true
      range_extra: 2.5
      gain_2d: 12.0
      gain_3d: 10.0
      tangent_bias: true
